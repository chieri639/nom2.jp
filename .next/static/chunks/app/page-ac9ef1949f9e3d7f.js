(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4167:function(e,t,n){Promise.resolve().then(n.bind(n,3964))},3964:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(7437),o=n(2265);let i={cold:"冷やして",room:"常温",warm:"燗"},l=[{label:"食事と合わせたい（食中酒）",tag:"食中酒"},{label:"プレゼントにしたい",tag:"プレゼント"},{label:"日本酒初心者向けがいい",tag:"初心者"},{label:"今っぽい/モダンな感じ",tag:"モダン"},{label:"王道/クラシックが好き",tag:"クラシック"}],a=[{label:"フルーティ",tag:"フルーティ"},{label:"すっきり",tag:"すっきり"},{label:"辛口",tag:"辛口"},{label:"甘口",tag:"甘口"}],s=[{label:"旨味",tag:"旨味"},{label:"コク",tag:"コク"},{label:"キレ",tag:"キレ"},{label:"濃醇",tag:"濃醇"}],d=[{label:"冷やして",key:"cold"},{label:"常温",key:"room"},{label:"燗",key:"warm"}];function uid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"m";return"".concat(e,"_").concat(Math.random().toString(36).slice(2,9),"_").concat(Date.now().toString(36))}function SakeChatRecoPage(){let[e,t]=(0,o.useState)([]),[n,c]=(0,o.useState)(!0),[m,v]=(0,o.useState)(null),[j,S]=(0,o.useState)(1),[k,w]=(0,o.useState)([]),[T,C]=(0,o.useState)(!1),[_,E]=(0,o.useState)([]),[z,O]=(0,o.useState)([]),[R,D]=(0,o.useState)([]),[B,M]=(0,o.useState)(""),[L,I]=(0,o.useState)(!1),W=(0,o.useRef)(null),F=(0,o.useRef)(null),scrollToBottom=()=>{var e;return null===(e=W.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth",block:"end"})};async function load(){c(!0),v(null);try{let e=await fetch("https://script.google.com/macros/s/AKfycbw3C6mroyk4Sr46I8qD86b_QYDjQKzDGDhdMtSWYNw66eWPOZIfUYDKHu-R0f8xnNL-/exec",{cache:"no-store"});if(!e.ok)throw Error("HTTP ".concat(e.status));let n=await e.json();if(!n.ok)throw Error("API returned ok=false");t(n.items||[])}catch(t){var e;v(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Failed to fetch")}finally{c(!1)}}(0,o.useEffect)(()=>{load()},[]),(0,o.useEffect)(()=>{w([{id:uid(),role:"bot",text:"日本酒AIです。5つの質問で、好みに合う銘柄を提案します\uD83C\uDF76"},{id:uid(),role:"bot",text:"Q1：今日はどんなシーン？（近いものを選んでください）"}]),S(1),I(!1)},[]),(0,o.useEffect)(()=>{L&&F.current&&setTimeout(()=>{var e;null===(e=F.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"})},100)},[L]),(0,o.useEffect)(()=>{L||scrollToBottom()},[k,T,L]),(0,o.useEffect)(()=>{let e=0,t=0,onTouchStart=n=>{1===n.touches.length&&(e=n.touches[0].clientX,t=n.touches[0].clientY)},onTouchMove=n=>{if(1!==n.touches.length)return;let r=Math.abs(n.touches[0].clientX-e),o=Math.abs(n.touches[0].clientY-t);r>o+2&&n.preventDefault()};return document.addEventListener("touchstart",onTouchStart,{passive:!0}),document.addEventListener("touchmove",onTouchMove,{passive:!1}),()=>{document.removeEventListener("touchstart",onTouchStart),document.removeEventListener("touchmove",onTouchMove)}},[]);let botSay=async e=>{C(!0),await new Promise(e=>setTimeout(e,400)),w(t=>[...t,{id:uid(),role:"bot",text:e}]),C(!1)},userSay=e=>{w(t=>[...t,{id:uid(),role:"user",text:e}])},nextQuestion=async e=>{2===e?await botSay("Q2：味の方向はどれが近い？（1つ選ぶ）"):3===e?await botSay("Q3：質感の好みは？（複数OK）"):4===e?await botSay("Q4：飲み方（温度）は？（複数OK）"):5===e&&await botSay("Q5：最後に。苦手なタイプ・合わせたい料理・予算など自由にどうぞ（任意）"),S(e)},handleSkip=async e=>{userSay("（スキップ）"),await nextQuestion(e)},pickMood=async e=>{var t,n;E([e]),userSay(null!==(n=null===(t=l.find(t=>t.tag===e))||void 0===t?void 0:t.label)&&void 0!==n?n:e),await nextQuestion(2)},pickDirection=async e=>{var t,n;O(t=>{let n=new Set(a.map(e=>e.tag)),r=t.filter(e=>!n.has(e));return[...r,e]}),userSay(null!==(n=null===(t=a.find(t=>t.tag===e))||void 0===t?void 0:t.label)&&void 0!==n?n:e),await nextQuestion(3)},toggleBody=e=>{O(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},confirmBody=async()=>{let e=z.filter(e=>s.some(t=>t.tag===e));userSay(e.length?"質感：".concat(e.join(" / ")):"質感：指定なし"),await nextQuestion(4)},toggleTemp=e=>{D(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},confirmTemp=async()=>{userSay(R.length?"温度：".concat(R.map(e=>{var t;return null!==(t=i[e])&&void 0!==t?t:e}).join(" / ")):"温度：指定なし"),await nextQuestion(5)},submit=async()=>{userSay(B.trim()?B.trim():"（自由入力なし）"),await botSay("了解！条件をまとめて、おすすめを出します…"),I(!0)},reset=()=>{E([]),O([]),D([]),M(""),I(!1),S(1),w([{id:uid(),role:"bot",text:"日本酒AIです。5つの質問で、好みに合う銘柄を提案します\uD83C\uDF76"},{id:uid(),role:"bot",text:"Q1：今日はどんなシーン？（近いものを選んでください）"}])},Q=(0,o.useMemo)(()=>{if(!L)return[];let t=[...e];R.length&&(t=t.filter(e=>(e.serve_temp||[]).some(e=>R.includes(e))));let n=[..._,...z].filter(Boolean);n.length&&(t=t.filter(e=>{let t=new Set([...e.style_tags||[],...e.taste_tags||[]]);return n.some(e=>t.has(e))}));let scoreOne=e=>{var t,r,o,i;let l=0,a=new Set([...e.style_tags||[],...e.taste_tags||[]]);for(let e of n)a.has(e)&&(l+=2);if(R.length)for(let t of R)(e.serve_temp||[]).includes(t)&&(l+=1);(null===(t=e.rakuten)||void 0===t?void 0:t.affiliate_url)&&(l+=1),(null===(r=e.rakuten)||void 0===r?void 0:r.image_url)&&(l+=1);let s=B.trim();if(s){let t="".concat(e.name," ").concat(null!==(o=e.brewery)&&void 0!==o?o:""," ").concat(null!==(i=e.prefecture)&&void 0!==i?i:"").toLowerCase(),n=s.split(/[,\s　]+/).map(e=>e.trim().toLowerCase()).filter(e=>e.length>=2);for(let e of n)t.includes(e)&&(l+=1)}return l};return t.map(e=>({s:e,score:scoreOne(e)})).sort((e,t)=>t.score-e.score).map(e=>e.s).slice(0,20)},[L,e,_,z,R,B]),A=(0,o.useMemo)(()=>{if(!L)return"";let e=[];_.length&&e.push("シーン：".concat(_.join(" / ")));let t=z.filter(e=>a.some(t=>t.tag===e)),n=z.filter(e=>s.some(t=>t.tag===e));return t.length&&e.push("方向：".concat(t.join(" / "))),n.length&&e.push("質感：".concat(n.join(" / "))),R.length&&e.push("温度：".concat(R.map(e=>{var t;return null!==(t=i[e])&&void 0!==t?t:e}).join(" / "))),e.join("｜")},[L,_,z,R]);return(0,r.jsxs)("div",{style:{minHeight:800,width:"100%",maxWidth:"min(960px, 100%)",margin:"0 auto",padding:14,boxSizing:"border-box",color:"#fff",overflowX:"hidden",fontFamily:"system-ui, -apple-system"},children:[(0,r.jsxs)("header",{style:{marginBottom:10},children:[(0,r.jsx)("div",{style:{fontSize:12,opacity:.75},children:"nom2.jp AI"}),(0,r.jsx)("h1",{style:{fontSize:18,margin:0,fontWeight:800},children:"おすすめ日本酒レコメンド"}),(0,r.jsx)("div",{style:{fontSize:11,opacity:.75,marginTop:4},children:"5つの質問に答えるだけで、あなた向けを提案します"})]}),(0,r.jsxs)("div",{style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.10)",borderRadius:16,padding:12,overflow:"hidden"},children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,maxHeight:520,overflowY:"auto",WebkitOverflowScrolling:"touch",paddingRight:4},children:[k.map(e=>(0,r.jsx)(ChatBubble,{role:e.role,text:e.text},e.id)),T&&(0,r.jsx)(ChatBubble,{role:"bot",text:"…",typing:!0}),L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:F,style:{scrollMarginTop:20}}),(0,r.jsx)(ChatBubble,{role:"bot",text:"条件まとめ：".concat(A||"指定なし")}),m?(0,r.jsx)("div",{style:{marginTop:10},children:(0,r.jsxs)("div",{style:b,children:[(0,r.jsx)("div",{style:{fontWeight:700,marginBottom:4},children:"読み込みに失敗しました"}),(0,r.jsx)("div",{style:{fontSize:12,opacity:.9},children:m})]})}):n?(0,r.jsx)("div",{style:{marginTop:10},children:(0,r.jsx)(SkeletonList,{})}):0===Q.length?(0,r.jsx)(ChatBubble,{role:"bot",text:"該当が見つかりませんでした。条件を少しゆるめて試してみてください。"}):(0,r.jsx)("div",{style:{marginTop:10,display:"grid",gap:10},children:Q.map(e=>(0,r.jsx)(SakeCard,{item:e},e.id))}),(0,r.jsxs)("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,r.jsx)("button",{onClick:reset,style:f,children:"もう一度診断する"}),(0,r.jsx)("button",{onClick:load,style:f,children:"データ更新"})]})]}),(0,r.jsx)("div",{ref:W})]}),!L&&(0,r.jsxs)("div",{style:{marginTop:12},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,r.jsxs)("div",{style:{fontSize:11,opacity:.75},children:["Step ",j,"/",5]}),(0,r.jsx)("button",{onClick:reset,style:g,children:"リセット"})]}),1===j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(OptionGrid,{children:l.map(e=>(0,r.jsx)("button",{onClick:()=>pickMood(e.tag),style:u,children:e.label},e.tag))}),(0,r.jsx)("div",{style:{marginTop:10,textAlign:"right"},children:(0,r.jsx)("button",{onClick:()=>handleSkip(2),style:x,children:"スキップ"})})]}),2===j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(OptionGrid,{children:a.map(e=>(0,r.jsx)("button",{onClick:()=>pickDirection(e.tag),style:u,children:e.label},e.tag))}),(0,r.jsx)("div",{style:{marginTop:10,textAlign:"right"},children:(0,r.jsx)("button",{onClick:()=>handleSkip(3),style:x,children:"スキップ"})})]}),3===j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{fontSize:11,opacity:.8,marginBottom:8},children:"複数選べます"}),(0,r.jsx)(OptionGrid,{children:s.map(e=>{let t=z.includes(e.tag);return(0,r.jsx)("button",{onClick:()=>toggleBody(e.tag),style:{...u,...t?h:{}},children:e.label},e.tag)})}),(0,r.jsxs)("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("button",{onClick:()=>handleSkip(4),style:x,children:"スキップ"}),(0,r.jsx)("button",{onClick:confirmBody,style:p,children:"次へ"})]})]}),4===j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{fontSize:11,opacity:.8,marginBottom:8},children:"複数選べます"}),(0,r.jsx)(OptionGrid,{children:d.map(e=>{let t=R.includes(e.key);return(0,r.jsx)("button",{onClick:()=>toggleTemp(e.key),style:{...u,...t?h:{}},children:e.label},e.key)})}),(0,r.jsxs)("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("button",{onClick:()=>handleSkip(5),style:x,children:"スキップ"}),(0,r.jsx)("button",{onClick:confirmTemp,style:p,children:"次へ"})]})]}),5===j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("textarea",{value:B,onChange:e=>M(e.target.value),placeholder:"例：お寿司に合わせたい、辛口は苦手、予算は3,000円くらい…など",style:y}),(0,r.jsxs)("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",gap:8},children:[(0,r.jsx)("button",{onClick:()=>{submit()},style:p,disabled:n,title:n?"データ読み込み中です":"送信しておすすめを見る",children:n?"読み込み中…":"送信しておすすめを見る"}),(0,r.jsx)("button",{onClick:()=>{M(""),submit()},style:f,disabled:n,children:"スキップ"})]})]})]})]}),(0,r.jsx)("footer",{style:{marginTop:12,fontSize:11,opacity:.55,textAlign:"center"},children:"データ提供：SakeMaster / 楽天アフィリンク"})]})}function ChatBubble(e){let{role:t,text:n,typing:o}=e,i="user"===t;return(0,r.jsx)("div",{style:{display:"flex",justifyContent:i?"flex-end":"flex-start"},children:(0,r.jsx)("div",{style:{maxWidth:"92%",padding:"10px 12px",borderRadius:14,background:i?"rgba(255,255,255,0.18)":"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.12)",fontSize:13,lineHeight:1.5,whiteSpace:"pre-wrap",overflowWrap:"anywhere"},children:o?(0,r.jsx)("span",{style:{opacity:.85},children:"typing…"}):n})})}function OptionGrid(e){let{children:t}=e;return(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr)",gap:8},children:t})}function SakeCard(e){var t,n,o;let{item:l}=e,a=null===(t=l.rakuten)||void 0===t?void 0:t.image_url,s=(null===(n=l.rakuten)||void 0===n?void 0:n.affiliate_url)||(null===(o=l.rakuten)||void 0===o?void 0:o.item_url);return(0,r.jsx)("article",{style:{background:"#fff",border:"1px solid #eee",borderRadius:14,padding:12,color:"#333"},children:(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"92px 1fr",gap:12},children:[(0,r.jsx)("div",{style:{width:92,height:92,borderRadius:12,background:"#f2f2f2",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",flex:"0 0 auto"},children:a?(0,r.jsx)("img",{src:a,alt:l.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,r.jsx)("span",{style:{fontSize:11,opacity:.6},children:"No Image"})}),(0,r.jsxs)("div",{style:{minWidth:0},children:[(0,r.jsx)("div",{style:{fontWeight:800,lineHeight:1.2},children:l.name}),(l.brewery||l.prefecture)&&(0,r.jsxs)("div",{style:{fontSize:12,opacity:.75,marginTop:2},children:[l.brewery,l.prefecture&&(0,r.jsxs)("span",{style:{marginLeft:6},children:["(",l.prefecture,")"]})]}),(0,r.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:8},children:[(l.style_tags||[]).slice(0,3).map(e=>(0,r.jsx)("span",{style:c,children:e},"st-".concat(e))),(l.taste_tags||[]).slice(0,4).map(e=>(0,r.jsx)("span",{style:c,children:e},"tt-".concat(e))),(l.serve_temp||[]).slice(0,3).map(e=>(0,r.jsx)("span",{style:c,children:i[e]||e},"tp-".concat(e)))]}),l.reason&&(0,r.jsx)("p",{style:{margin:"8px 0 0",fontSize:13,lineHeight:1.45},children:l.reason}),(0,r.jsx)("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:(0,r.jsx)("a",{href:s||"#",target:"_blank",rel:"noopener noreferrer",style:{...p,display:"inline-block",textDecoration:"none",pointerEvents:s?"auto":"none",opacity:s?1:.5},children:"購入する"})})]})]})})}function SkeletonList(){return(0,r.jsx)(r.Fragment,{children:Array.from({length:4}).map((e,t)=>(0,r.jsx)("div",{style:{background:"#fff",border:"1px solid #eee",borderRadius:14,padding:12,height:120}},t))})}let c={fontSize:11,padding:"4px 8px",borderRadius:999,background:"#f3f3f3",border:"1px solid #e9e9e9",color:"#333"},u={textAlign:"left",padding:"10px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:13,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},h={background:"rgba(255,255,255,0.18)",border:"1px solid rgba(255,255,255,0.25)"},p={padding:"10px 14px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #111, #333)",color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer"},f={padding:"10px 14px",borderRadius:12,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.08)",color:"#fff",fontSize:13,fontWeight:600,cursor:"pointer"},g={background:"transparent",border:"none",color:"rgba(255,255,255,0.8)",fontSize:12,cursor:"pointer",textDecoration:"underline"},x={background:"transparent",border:"none",color:"rgba(255,255,255,0.6)",fontSize:13,cursor:"pointer",padding:"8px"},y={width:"100%",minHeight:84,borderRadius:12,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(0,0,0,0.25)",color:"#fff",padding:"10px 12px",fontSize:16,outline:"none",boxSizing:"border-box",resize:"vertical"},b={background:"#fff0f0",border:"1px solid #ffd0d0",padding:12,borderRadius:12,color:"#d32f2f"};function Home(){return(0,o.useEffect)(()=>{let e=0,t=0,onTouchStart=n=>{1===n.touches.length&&(e=n.touches[0].clientX,t=n.touches[0].clientY)},onTouchMove=n=>{if(1!==n.touches.length)return;let r=Math.abs(n.touches[0].clientX-e),o=Math.abs(n.touches[0].clientY-t);r>o+2&&n.preventDefault()};return document.addEventListener("touchstart",onTouchStart,{passive:!0}),document.addEventListener("touchmove",onTouchMove,{passive:!1}),()=>{document.removeEventListener("touchstart",onTouchStart),document.removeEventListener("touchmove",onTouchMove)}},[]),(0,r.jsx)(SakeChatRecoPage,{})}},622:function(e,t,n){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,n){var r,i={},d=null,c=null;for(r in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)l.call(t,r)&&!s.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:d,ref:c,props:i,_owner:a.current}}t.Fragment=i,t.jsx=q,t.jsxs=q},7437:function(e,t,n){"use strict";e.exports=n(622)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=4167)}),_N_E=e.O()}]);