(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7310:e=>{"use strict";e.exports=require("url")},8009:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d});var i=r(7096),n=r(6132),o=r(7284),s=r.n(o),a=r(2564),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);r.d(t,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8203)),"/Users/chieri.ishizaki.54/Documents/日本酒AI/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,9113)),"/Users/chieri.ishizaki.54/Documents/日本酒AI/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/chieri.ishizaki.54/Documents/日本酒AI/src/app/page.tsx"],u="/page",p={require:r,loadChunk:()=>Promise.resolve()},h=new i.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5080:(e,t,r)=>{Promise.resolve().then(r.bind(r,5450))},5450:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Home});var i=r(784),n=r(9885);let o={cold:"冷やして",room:"常温",warm:"燗"},s=[{label:"食事と合わせたい（食中酒）",tag:"食中酒"},{label:"プレゼントにしたい",tag:"プレゼント"},{label:"日本酒初心者向けがいい",tag:"初心者"},{label:"今っぽい/モダンな感じ",tag:"モダン"},{label:"王道/クラシックが好き",tag:"クラシック"}],a=[{label:"フルーティ",tag:"フルーティ"},{label:"すっきり",tag:"すっきり"},{label:"辛口",tag:"辛口"},{label:"甘口",tag:"甘口"}],l=[{label:"旨味",tag:"旨味"},{label:"コク",tag:"コク"},{label:"キレ",tag:"キレ"},{label:"濃醇",tag:"濃醇"}],d=[{label:"冷やして",key:"cold"},{label:"常温",key:"room"},{label:"燗",key:"warm"}];function uid(e="m"){return`${e}_${Math.random().toString(36).slice(2,9)}_${Date.now().toString(36)}`}function SakeChatRecoPage(){let[e,t]=(0,n.useState)([]),[r,c]=(0,n.useState)(!0),[y,j]=(0,n.useState)(null),[v,S]=(0,n.useState)(1),[k,w]=(0,n.useState)([]),[_,T]=(0,n.useState)(!1),[C,z]=(0,n.useState)([]),[M,D]=(0,n.useState)([]),[E,P]=(0,n.useState)([]),[R,$]=(0,n.useState)(""),[A,B]=(0,n.useState)(!1),I=(0,n.useRef)(null),W=(0,n.useRef)(null),scrollToBottom=()=>I.current?.scrollIntoView({behavior:"smooth",block:"end"});async function load(){c(!0),j(null);try{let e=await fetch("https://script.google.com/macros/s/AKfycbw3C6mroyk4Sr46I8qD86b_QYDjQKzDGDhdMtSWYNw66eWPOZIfUYDKHu-R0f8xnNL-/exec",{cache:"no-store"});if(!e.ok)throw Error(`HTTP ${e.status}`);let r=await e.json();if(!r.ok)throw Error("API returned ok=false");t(r.items||[])}catch(e){j(e?.message??"Failed to fetch")}finally{c(!1)}}(0,n.useEffect)(()=>{load()},[]),(0,n.useEffect)(()=>{w([{id:uid(),role:"bot",text:"日本酒AIです。5つの質問で、好みに合う銘柄を提案します\uD83C\uDF76"},{id:uid(),role:"bot",text:"Q1：今日はどんなシーン？（近いものを選んでください）"}]),S(1),B(!1)},[]),(0,n.useEffect)(()=>{A&&W.current&&setTimeout(()=>{W.current?.scrollIntoView({behavior:"smooth",block:"start"})},100)},[A]),(0,n.useEffect)(()=>{A||scrollToBottom()},[k,_,A]),(0,n.useEffect)(()=>{let e=0,t=0,onTouchStart=r=>{1===r.touches.length&&(e=r.touches[0].clientX,t=r.touches[0].clientY)},onTouchMove=r=>{if(1!==r.touches.length)return;let i=Math.abs(r.touches[0].clientX-e),n=Math.abs(r.touches[0].clientY-t);i>n+2&&r.preventDefault()};return document.addEventListener("touchstart",onTouchStart,{passive:!0}),document.addEventListener("touchmove",onTouchMove,{passive:!1}),()=>{document.removeEventListener("touchstart",onTouchStart),document.removeEventListener("touchmove",onTouchMove)}},[]);let botSay=async e=>{T(!0),await new Promise(e=>setTimeout(e,400)),w(t=>[...t,{id:uid(),role:"bot",text:e}]),T(!1)},userSay=e=>{w(t=>[...t,{id:uid(),role:"user",text:e}])},nextQuestion=async e=>{2===e?await botSay("Q2：味の方向はどれが近い？（1つ選ぶ）"):3===e?await botSay("Q3：質感の好みは？（複数OK）"):4===e?await botSay("Q4：飲み方（温度）は？（複数OK）"):5===e&&await botSay("Q5：最後に。苦手なタイプ・合わせたい料理・予算など自由にどうぞ（任意）"),S(e)},handleSkip=async e=>{userSay("（スキップ）"),await nextQuestion(e)},pickMood=async e=>{z([e]),userSay(s.find(t=>t.tag===e)?.label??e),await nextQuestion(2)},pickDirection=async e=>{D(t=>{let r=new Set(a.map(e=>e.tag)),i=t.filter(e=>!r.has(e));return[...i,e]}),userSay(a.find(t=>t.tag===e)?.label??e),await nextQuestion(3)},toggleBody=e=>{D(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},confirmBody=async()=>{let e=M.filter(e=>l.some(t=>t.tag===e));userSay(e.length?`質感：${e.join(" / ")}`:"質感：指定なし"),await nextQuestion(4)},toggleTemp=e=>{P(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},confirmTemp=async()=>{userSay(E.length?`温度：${E.map(e=>o[e]??e).join(" / ")}`:"温度：指定なし"),await nextQuestion(5)},submit=async()=>{userSay(R.trim()?R.trim():"（自由入力なし）"),await botSay("了解！条件をまとめて、おすすめを出します…"),B(!0)},reset=()=>{z([]),D([]),P([]),$(""),B(!1),S(1),w([{id:uid(),role:"bot",text:"日本酒AIです。5つの質問で、好みに合う銘柄を提案します\uD83C\uDF76"},{id:uid(),role:"bot",text:"Q1：今日はどんなシーン？（近いものを選んでください）"}])},L=(0,n.useMemo)(()=>{if(!A)return[];let t=[...e];E.length&&(t=t.filter(e=>(e.serve_temp||[]).some(e=>E.includes(e))));let r=[...C,...M].filter(Boolean);r.length&&(t=t.filter(e=>{let t=new Set([...e.style_tags||[],...e.taste_tags||[]]);return r.some(e=>t.has(e))}));let scoreOne=e=>{let t=0,i=new Set([...e.style_tags||[],...e.taste_tags||[]]);for(let e of r)i.has(e)&&(t+=2);if(E.length)for(let r of E)(e.serve_temp||[]).includes(r)&&(t+=1);e.rakuten?.affiliate_url&&(t+=1),e.rakuten?.image_url&&(t+=1);let n=R.trim();if(n){let r=`${e.name} ${e.brewery??""} ${e.prefecture??""}`.toLowerCase(),i=n.split(/[,\s　]+/).map(e=>e.trim().toLowerCase()).filter(e=>e.length>=2);for(let e of i)r.includes(e)&&(t+=1)}return t};return t.map(e=>({s:e,score:scoreOne(e)})).sort((e,t)=>t.score-e.score).map(e=>e.s).slice(0,20)},[A,e,C,M,E,R]),Q=(0,n.useMemo)(()=>{if(!A)return"";let e=[];C.length&&e.push(`シーン：${C.join(" / ")}`);let t=M.filter(e=>a.some(t=>t.tag===e)),r=M.filter(e=>l.some(t=>t.tag===e));return t.length&&e.push(`方向：${t.join(" / ")}`),r.length&&e.push(`質感：${r.join(" / ")}`),E.length&&e.push(`温度：${E.map(e=>o[e]??e).join(" / ")}`),e.join("｜")},[A,C,M,E]);return(0,i.jsxs)("div",{style:{minHeight:800,width:"100%",maxWidth:"min(960px, 100%)",margin:"0 auto",padding:14,boxSizing:"border-box",color:"#fff",overflowX:"hidden",fontFamily:"system-ui, -apple-system"},children:[(0,i.jsxs)("header",{style:{marginBottom:10},children:[i.jsx("div",{style:{fontSize:12,opacity:.75},children:"nom2.jp AI"}),i.jsx("h1",{style:{fontSize:18,margin:0,fontWeight:800},children:"おすすめ日本酒レコメンド"}),i.jsx("div",{style:{fontSize:11,opacity:.75,marginTop:4},children:"5つの質問に答えるだけで、あなた向けを提案します"})]}),(0,i.jsxs)("div",{style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.10)",borderRadius:16,padding:12,overflow:"hidden"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,maxHeight:520,overflowY:"auto",WebkitOverflowScrolling:"touch",paddingRight:4},children:[k.map(e=>i.jsx(ChatBubble,{role:e.role,text:e.text},e.id)),_&&i.jsx(ChatBubble,{role:"bot",text:"…",typing:!0}),A&&(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{ref:W,style:{scrollMarginTop:20}}),i.jsx(ChatBubble,{role:"bot",text:`条件まとめ：${Q||"指定なし"}`}),y?i.jsx("div",{style:{marginTop:10},children:(0,i.jsxs)("div",{style:b,children:[i.jsx("div",{style:{fontWeight:700,marginBottom:4},children:"読み込みに失敗しました"}),i.jsx("div",{style:{fontSize:12,opacity:.9},children:y})]})}):r?i.jsx("div",{style:{marginTop:10},children:i.jsx(SkeletonList,{})}):0===L.length?i.jsx(ChatBubble,{role:"bot",text:"該当が見つかりませんでした。条件を少しゆるめて試してみてください。"}):i.jsx("div",{style:{marginTop:10,display:"grid",gap:10},children:L.map(e=>i.jsx(SakeCard,{item:e},e.id))}),(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[i.jsx("button",{onClick:reset,style:g,children:"もう一度診断する"}),i.jsx("button",{onClick:load,style:g,children:"データ更新"})]})]}),i.jsx("div",{ref:I})]}),!A&&(0,i.jsxs)("div",{style:{marginTop:12},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,i.jsxs)("div",{style:{fontSize:11,opacity:.75},children:["Step ",v,"/",5]}),i.jsx("button",{onClick:reset,style:x,children:"リセット"})]}),1===v&&(0,i.jsxs)(i.Fragment,{children:[i.jsx(OptionGrid,{children:s.map(e=>i.jsx("button",{onClick:()=>pickMood(e.tag),style:u,children:e.label},e.tag))}),i.jsx("div",{style:{marginTop:10,textAlign:"right"},children:i.jsx("button",{onClick:()=>handleSkip(2),style:f,children:"スキップ"})})]}),2===v&&(0,i.jsxs)(i.Fragment,{children:[i.jsx(OptionGrid,{children:a.map(e=>i.jsx("button",{onClick:()=>pickDirection(e.tag),style:u,children:e.label},e.tag))}),i.jsx("div",{style:{marginTop:10,textAlign:"right"},children:i.jsx("button",{onClick:()=>handleSkip(3),style:f,children:"スキップ"})})]}),3===v&&(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{style:{fontSize:11,opacity:.8,marginBottom:8},children:"複数選べます"}),i.jsx(OptionGrid,{children:l.map(e=>{let t=M.includes(e.tag);return i.jsx("button",{onClick:()=>toggleBody(e.tag),style:{...u,...t?p:{}},children:e.label},e.tag)})}),(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("button",{onClick:()=>handleSkip(4),style:f,children:"スキップ"}),i.jsx("button",{onClick:confirmBody,style:h,children:"次へ"})]})]}),4===v&&(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{style:{fontSize:11,opacity:.8,marginBottom:8},children:"複数選べます"}),i.jsx(OptionGrid,{children:d.map(e=>{let t=E.includes(e.key);return i.jsx("button",{onClick:()=>toggleTemp(e.key),style:{...u,...t?p:{}},children:e.label},e.key)})}),(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("button",{onClick:()=>handleSkip(5),style:f,children:"スキップ"}),i.jsx("button",{onClick:confirmTemp,style:h,children:"次へ"})]})]}),5===v&&(0,i.jsxs)(i.Fragment,{children:[i.jsx("textarea",{value:R,onChange:e=>$(e.target.value),placeholder:"例：お寿司に合わせたい、辛口は苦手、予算は3,000円くらい…など",style:m}),(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",gap:8},children:[i.jsx("button",{onClick:()=>{submit()},style:h,disabled:r,title:r?"データ読み込み中です":"送信しておすすめを見る",children:r?"読み込み中…":"送信しておすすめを見る"}),i.jsx("button",{onClick:()=>{$(""),submit()},style:g,disabled:r,children:"スキップ"})]})]})]})]}),i.jsx("footer",{style:{marginTop:12,fontSize:11,opacity:.55,textAlign:"center"},children:"データ提供：SakeMaster / 楽天アフィリンク"})]})}function ChatBubble({role:e,text:t,typing:r}){let n="user"===e;return i.jsx("div",{style:{display:"flex",justifyContent:n?"flex-end":"flex-start"},children:i.jsx("div",{style:{maxWidth:"92%",padding:"10px 12px",borderRadius:14,background:n?"rgba(255,255,255,0.18)":"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.12)",fontSize:13,lineHeight:1.5,whiteSpace:"pre-wrap",overflowWrap:"anywhere"},children:r?i.jsx("span",{style:{opacity:.85},children:"typing…"}):t})})}function OptionGrid({children:e}){return i.jsx("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr)",gap:8},children:e})}function SakeCard({item:e}){let t=e.rakuten?.image_url,r=e.rakuten?.affiliate_url||e.rakuten?.item_url;return i.jsx("article",{style:{background:"#fff",border:"1px solid #eee",borderRadius:14,padding:12,color:"#333"},children:(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"92px 1fr",gap:12},children:[i.jsx("div",{style:{width:92,height:92,borderRadius:12,background:"#f2f2f2",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",flex:"0 0 auto"},children:t?i.jsx("img",{src:t,alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):i.jsx("span",{style:{fontSize:11,opacity:.6},children:"No Image"})}),(0,i.jsxs)("div",{style:{minWidth:0},children:[i.jsx("div",{style:{fontWeight:800,lineHeight:1.2},children:e.name}),(e.brewery||e.prefecture)&&(0,i.jsxs)("div",{style:{fontSize:12,opacity:.75,marginTop:2},children:[e.brewery,e.prefecture&&(0,i.jsxs)("span",{style:{marginLeft:6},children:["(",e.prefecture,")"]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:8},children:[(e.style_tags||[]).slice(0,3).map(e=>i.jsx("span",{style:c,children:e},`st-${e}`)),(e.taste_tags||[]).slice(0,4).map(e=>i.jsx("span",{style:c,children:e},`tt-${e}`)),(e.serve_temp||[]).slice(0,3).map(e=>i.jsx("span",{style:c,children:o[e]||e},`tp-${e}`))]}),e.reason&&i.jsx("p",{style:{margin:"8px 0 0",fontSize:13,lineHeight:1.45},children:e.reason}),i.jsx("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:i.jsx("a",{href:r||"#",target:"_blank",rel:"noopener noreferrer",style:{...h,display:"inline-block",textDecoration:"none",pointerEvents:r?"auto":"none",opacity:r?1:.5},children:"購入する"})})]})]})})}function SkeletonList(){return i.jsx(i.Fragment,{children:Array.from({length:4}).map((e,t)=>i.jsx("div",{style:{background:"#fff",border:"1px solid #eee",borderRadius:14,padding:12,height:120}},t))})}let c={fontSize:11,padding:"4px 8px",borderRadius:999,background:"#f3f3f3",border:"1px solid #e9e9e9",color:"#333"},u={textAlign:"left",padding:"10px 12px",borderRadius:14,border:"1px solid rgba(255,255,255,0.14)",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:13,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},p={background:"rgba(255,255,255,0.18)",border:"1px solid rgba(255,255,255,0.25)"},h={padding:"10px 14px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #111, #333)",color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer"},g={padding:"10px 14px",borderRadius:12,border:"1px solid rgba(255,255,255,0.18)",background:"rgba(255,255,255,0.08)",color:"#fff",fontSize:13,fontWeight:600,cursor:"pointer"},x={background:"transparent",border:"none",color:"rgba(255,255,255,0.8)",fontSize:12,cursor:"pointer",textDecoration:"underline"},f={background:"transparent",border:"none",color:"rgba(255,255,255,0.6)",fontSize:13,cursor:"pointer",padding:"8px"},m={width:"100%",minHeight:84,borderRadius:12,border:"1px solid rgba(255,255,255,0.16)",background:"rgba(0,0,0,0.25)",color:"#fff",padding:"10px 12px",fontSize:16,outline:"none",boxSizing:"border-box",resize:"vertical"},b={background:"#fff0f0",border:"1px solid #ffd0d0",padding:12,borderRadius:12,color:"#d32f2f"};function Home(){return(0,n.useEffect)(()=>{let e=0,t=0,onTouchStart=r=>{1===r.touches.length&&(e=r.touches[0].clientX,t=r.touches[0].clientY)},onTouchMove=r=>{if(1!==r.touches.length)return;let i=Math.abs(r.touches[0].clientX-e),n=Math.abs(r.touches[0].clientY-t);i>n+2&&r.preventDefault()};return document.addEventListener("touchstart",onTouchStart,{passive:!0}),document.addEventListener("touchmove",onTouchMove,{passive:!1}),()=>{document.removeEventListener("touchstart",onTouchStart),document.removeEventListener("touchmove",onTouchMove)}},[]),i.jsx(SakeChatRecoPage,{})}},8203:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>s,__esModule:()=>o,default:()=>l});var i=r(5153);let n=(0,i.createProxy)(String.raw`/Users/chieri.ishizaki.54/Documents/日本酒AI/src/app/page.tsx`),{__esModule:o,$$typeof:s}=n,a=n.default,l=a},784:(e,t,r)=>{"use strict";e.exports=r(316).vendored["react-ssr"].ReactJsxRuntime}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[485,252],()=>__webpack_exec__(8009));module.exports=r})();